# User Rewards HTTP Server

Простой HTTP-сервер на Go для управления пользователями, выполнением заданий и начислением наград.

## Описание

Сервер реализует логику создания пользователя, выполнения им заданий (например, подписка на Telegram, ввод реферального кода и др.) и начисления наград в виде поинтов.  
Проект включает авторизацию через JWT, API для взаимодействия, хранилище на PostgreSQL и разворачивается через Docker Compose.

## Стек технологий

- Go (Gin, JWT)
- PostgreSQL
- golang-migrate
- Docker + Docker Compose
- Postman (тестирование API)

## Запуск проекта

1. **Клонировать репозиторий:**

```bash
git clone https://github.com/oksuide/user-rewards-server.git
cd user-rewards-server
```

2. **Запустить Docker Compose:**
```bash
docker-compose up --build
```
## API Эндпоинты
Метод	    Эндпоинт	                    Описание                                    Защита
POST        api/register                    Регистрация пользователя                       -
POST        api/login                       Авторизация пользователя                       -
GET	        api/users/{id}/status	        Получить информацию о пользователе             +
GET	        api/users/leaderboard	        Топ пользователей по количеству поинтов        +
POST	    api/users/{id}/task/complete	Завершить задание и получить награду           +
POST	    api/users/{id}/referrer	        Ввод реферального кода (ID пользователя)       +

Часть эндпоинтов защищены JWT.
Перед использованием необходимо получить и передать Authorization: Bearer <token> в заголовках запроса.

## Аутентификация
Аутентификация реализована через JWT (access token).
Middleware проверяет токен и допускает доступ только авторизованным пользователям.

## Структура проекта
```bash
.
├── cmd/
│   └── main.go                  # Точка входа в приложение
├── config/
│   └── config.go                # Загрузка и парсинг конфигурации
├── internal/
│   ├── auth/                    # Аутентификация и генерация JWT
│   ├── handlers/                # HTTP-хендлеры для API
│   ├── middleware/              # JWT middleware и другие промежуточные обработчики
│   ├── models/                  # Структуры данных
│   ├── repository/              # Репозитории для работы с PostgreSQL
│   ├── service/                 # Бизнес-логика
│   └── storage/                 # Инициализация базы данных
├── migrations/                  # SQL миграции для инициализации и обновления схемы БД
├── postman/
│   ├── Test API.postman_collection.json            # Коллекция запросов для Postman
│   └── New Environment.postman_environment.json    # Окружение для Postman
├── config.yaml                  # Конфигурационный файл
├── Dockerfile                   # Инструкция сборки Docker-образа
├── docker-compose.yml           # Docker Compose конфигурация для приложения и БД
├── entrypoint.sh                # Скрипт начальной инициализации контейнера
├── go.mod                       # Модули и зависимости проекта
├── go.sum                       # Контрольные суммы зависимостей
└── README.md                    # Документация проекта
```

## Тестирование
Тестирование API выполнено с помощью Postman.
Коллекция и окружение находятся в директории postman/.
1. Импортируйте файл Test API.postman_collection.json
2. Импортируйте окружение New Environment.postman_environment.json
3. Установите значения переменных (например, BASE_URL, TOKEN)
4. Запустите тесты

## Обработка ошибок
Обработка ошибок реализована на каждом уровне:
Валидация входных параметров
Проверка существования пользователей/заданий
Корректные коды ответа (400, 401, 404, 500 и др.)
Единый формат ошибок

## Дополнительно
Соблюдены принципы SOLID и чистой архитектуры
Проект легко расширяем — можно добавлять новые типы заданий, награды и бизнес-логику
Все зависимости инкапсулированы, код разбит на логические модули